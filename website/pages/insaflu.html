<!DOCTYPE html>
<html lang="en">
<head>
    <title>INSaFLU Visualization Frameworks</title>
    <meta charset="utf-8">
    <link href='../style/index.css' rel="stylesheet">
    <link rel="icon" href="../img/logo.png">
    <script src="https://cdn.rawgit.com/phylocanvas/phylocanvas-quickstart/v2.8.1/phylocanvas-quickstart.js"></script>

    <!-- Load d3.js and the geo projection plugin -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- Load Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>

    <style>

    </style>

</head>

<body style="min-width: 1700px; margin: auto">

<header>

    <div style="border-style: dashed; border-color: transparent; width: 100%; margin: auto;">
        <div style="border-style: dashed; border-color: transparent; float: left; margin-top: 2%; margin-left: 10%">
            <a href="https://www.ulisboa.pt/" target="_blank" rel="noopener noreferrer">
                <img src="../img/ul.png" width="150" alt="UL">
            </a>
        </div>

        <div style="border-style: dashed; border-color: transparent; float: left;margin-top: 1.5%; margin-left: 10%">
            <a href="https://ist.pt" target="_blank" rel="noopener noreferrer">
                <img src="../img/ist.jpg" width="130" alt="IST">
            </a>
        </div>

        <div style="border-style: dashed; border-color: transparent; float: left;margin-top: 1.5%; margin-left: 9%">
            <a href="http://www.medicina.ulisboa.pt/" target="_blank" rel="noopener noreferrer">
                <img src="../img/fmul.png" width="130" alt="FMUL">
            </a>
        </div>

        <div style="border-style: dashed; border-color: transparent; float: right;margin-top: 2.2%; margin-right: 10%">
            <a href="http://www.insa.pt/" target="_blank" rel="noopener noreferrer">
                <img src="../img/logoentidade.png" width="180" alt="INSA">
            </a>
        </div>

        <div style="border-style: dashed; border-color: transparent; float: right; margin-top: 1.8%; margin-right: 8%">
            <a href="https://imm.medicina.ulisboa.pt/pt/" target="_blank" rel="noopener noreferrer">
                <img src="../img/imm.png" width="130" alt="iMM">
            </a>
        </div>
    </div>

    <p style="margin-top: 7%; text-align: center; font-size: 45px;"><a href="../index.html" style="color: black; text-decoration: none">Community Finding with Applications on Phylogenetic Networks</a></p>

</header>

<div style="display: block; width: 90%; float: left; margin-right: 50px; margin-left: 75px; margin-top: 50px; border-style: solid; position: relative; padding-bottom: 25px">
    <h2 style="text-align: center; font-size: 30px;">Phylogenetic Tree &#127794;</h2>

    <div id="phylocanvas" style="height: 500px; margin-left: 5%; margin-right: 5%; margin-top: 25px; border-style: solid; overflow: hidden"></div>

</div>

<div style="display: block; width: 90%; float: left; margin-right: 50px; margin-left: 75px; margin-top: 50px; margin-bottom: 50px; border-style: solid; padding-bottom: 25px">
    <h2 style="text-align: center; font-size: 30px;">Geographical Map &#127757;</h2>

        <div id="mapid" style="height: 500px; margin-left: 5%; margin-right: 5%; margin-top: 25px; border-style: solid; position: relative"></div>
</div>

<div class="container2" style="background-color: black; height: 50px; margin: auto">
    <p style="padding-left: 50px"><a href="https://warcraft12321.github.io/LUI/" target="_blank" rel="noopener noreferrer"><img src="../img/luiss.png" width="50px" alt="Luís"></a></p>
    <div id = "socialMedia">
        <a href = "https://www.researchgate.net/profile/Luis_Rita2" target="_blank" rel="noopener noreferrer">
            <img src = "../img/rg.png" width="25" style="margin-right: 5%" alt="ResearchGate">
        </a>
        <a href = "https://www.npmjs.com/~warcraft12321" target="_blank" rel="noopener noreferrer">
            <img src = "../img/npm.png" width="50" style="margin-right: 5%" alt="NPM">
        </a>
        <a href = "https://hub.docker.com/u/warcraft12321" target="_blank" rel="noopener noreferrer">
            <img src = "../img/docker.png" width="35" style="margin-right: 5%" alt="Docker Hub">
        </a>
        <a href = "https://github.com/warcraft12321" target="_blank" rel="noopener noreferrer">
            <img src = "../img/github.png" width="25" style="margin-right: 5%" alt="GitHub">
        </a>
    </div>
</div>

<script>

    // ------------------------------------------ Acquiring Data ------------------------------------------

    let data;

    fetch("/insaflu_tree/").then(function(res) {

        return res.text();

    }).then(function(jsonData) {

        data = jsonData;

    });

    fetch('/insaflu_sample/').then(function(res) {

        return res.json();

    }).then(function(jsonData) {

        phylTree(jsonData);
        geoMap(jsonData);
        plot("Circular");

    });

    // ------------------------------------------ Auxiliary Functions ------------------------------------------

    function hashCode(str) { // java String#hashCode
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        return hash;
    }

    function intToRGB(i){
        let c = (i & 0x00FFFFFF)
            .toString(16)
            .toUpperCase();

        return "00000".substring(0, 6 - c.length) + c;
    }

    function label2number(label, metadata, id) {

        let result = {};

        for (let i = 0; i < Object.keys(metadata).length; i++) {

            result[(metadata[i][label])] = (result[metadata[i][label]] + 1) || 0;
        }
        return result[id]
    }

    // ------------------------------------------ Phylogenetic Tree ------------------------------------------

    let tree = Phylocanvas.createTree('phylocanvas', {
/*
        metadata: {

            padding: 300

        },*/

        history: {
            parent: document.getElementById("mapid"),
            zIndex: -1000
        },

        baseNodeSize: 10,
        padding: 5,
        textSize: 10,
        font: "helvetica",
        root: "A_H3N2_reference_demo",
        zoomFactor: 2,
        labelPadding: 5,
        showLabels: true,
        lineWidth: 3,
        alignLabels: true,
      //  highlightColour: "red",
        highlightSize: 1,
        highlightWidth: -1
     //   showBranchLengthLabels: true

    });

    History.isOpen = true;

    function plot (type) {

        document.getElementById("shape").src = "../img/" + type.toLowerCase() + ".png";

        tree.load(data);

        // Tree - Functions
          tree.setTreeType(type.toLowerCase()); // Choosing type of tree: takes radial, rectangular, circular, diagonal and hierarchy.

        if (active === false) {

            for (let i = 0; i < tree.leaves.length; i++) {
                tree.leaves[i].data = {

                };
            }
        }

        tree.draw();
    }

    let active = false;

    function phylTree(metaData) {

        tree.on('beforeFirstDraw', function () {

            for (let i = 0; i < tree.leaves.length; i++) {

                for (let j = 0; j < Object.keys(Object.values(metaData)[i]).length; j++) {

                    (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]] = (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]] || {};

                    (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]]["colour"] = "#" + intToRGB(hashCode(Object.values(metaData[Object.keys(metaData)[i]])[j]));
                    (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]]["label"] = Object.values(metaData[Object.keys(metaData)[i]])[j];

                }
            }
        });

        document.getElementById("checkbox").addEventListener("change", function () {

            console.log(metaData);

            if(!active) {

                for (let i = 0; i < tree.leaves.length; i++) {

                    for (let j = 0; j < Object.keys(Object.values(metaData)[i]).length; j++) {

                        (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]] = (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]] || {};

                        (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]]["colour"] = "#" + intToRGB(hashCode(Object.values(metaData[Object.keys(metaData)[i]])[j]));
                        (tree.leaves[i].data)[Object.keys(metaData[Object.keys(metaData)[i]])[j]]["label"] = Object.values(metaData[Object.keys(metaData)[i]])[j];

                    }
                }

                active = true;

            } else {

                for (let i = 0; i < tree.leaves.length; i++) {
                    tree.leaves[i].data = {

                    };
                }

                active = false;

            }
            tree.draw();

        });
    }

    // -------------------------------------- Buttons

    let enableView = document.createElement("IMG");

    let firstDiv = document.createElement("DIV");
    let secondDiv = document.createElement("DIV");

    let button6 = document.createElement("IMG");
    let metaData = document.createElement("BUTTON");

    let a1 = document.createElement("IMG");
    let a2 = document.createElement("IMG");
    let a3 = document.createElement("IMG");
    let a4 = document.createElement("IMG");
    let a5 = document.createElement("IMG");

    let radio = document.createElement("INPUT");

    let range1 = document.createElement("INPUT");
    let range2 = document.createElement("INPUT");

    let controller1 = document.createElement("DIV");

    firstDiv.id = "firstDiv";
    firstDiv.classList.add("toggle");
    firstDiv.classList.add("dropdown");
    firstDiv.style.position = "absolute";
    firstDiv.style.left = "53%";
    firstDiv.style.bottom = "10px";
    firstDiv.style.zIndex = "2";
    firstDiv.style.display = "none";

    secondDiv.id = "dropdown-content";
    secondDiv.class = "dropdown-content";
    secondDiv.style.lineHeight = "18px";
    secondDiv.style.display = "none";
    secondDiv.style.position = "absolute";
    secondDiv.style.bottom = "30px";
    secondDiv.style.left = "-50%";
    secondDiv.style.zIndex = "20";
    secondDiv.style.boxShadow = "0 8px 16px 0 rgba(0,0,0,0.2)";
    secondDiv.onmouseover = appear;
    secondDiv.onmouseout = disappear;

    button6.id = "shape";
    button6.style.textAlign = "center";
    button6.onmouseover = appear;
    button6.onmouseout = disappear;
    button6.onclick = backFunc2;
    button6.src = "../img/circular.png";
    button6.style.width = "30px";
    button6.style.left = "50%";

    a1.id = "Radial";
    a1.style.cursor = "pointer";
    a1.style.display = "block";
    a1.style.padding = "12px 16px";
    a1.style.zIndex = "2";
    a1.src = "../img/radial.png";
    a1.style.width = "25px";

    a2.id = "Rectangular";
    a2.style.cursor = "pointer";
    a2.style.display = "block";
    a2.style.padding = "12px 16px";
    a2.style.zIndex = "2";
    a2.src = "../img/rectangular.png";
    a2.style.width = "25px";

    a3.id = "Circular";
    a3.style.cursor = "pointer";
    a3.style.display = "block";
    a3.style.padding = "12px 16px";
    a3.style.zIndex = "2";
    a3.src = "../img/circular.png";
    a3.style.width = "25px";

    a4.id = "Diagonal";
    a4.style.cursor = "pointer";
    a4.style.display = "block";
    a4.style.padding = "12px 16px";
    a4.style.zIndex = "2";
    a4.src = "../img/diagonal.png";
    a4.style.width = "25px";

    a5.id = "Hierarchical";
    a5.style.cursor = "pointer";
    a5.style.display = "block";
    a5.style.padding = "12px 16px";
    a5.style.zIndex = "2";
    a5.src = "../img/hierarchical.png";
    a5.style.width = "25px";

    radio.type = "checkbox";
    radio.id = "checkbox";
    radio.style.zIndex = "2";
    radio.style.position = "absolute";
    radio.style.left = "50%";
    radio.style.bottom = "10px";
    radio.className = "toggle";
    radio.style.cursor = "pointer";
    radio.style.display = "none";

    range1.type = "range";
    range1.id = "range1";
    range1.style.zIndex = "2";
    range1.style.position = "absolute";
    range1.style.left = "35%";
    range1.style.bottom = "10px";
    range1.className = "toggle";
    range1.style.cursor = "pointer";
    range1.style.width = "10%";
    range1.style.display = "none";

    range2.type = "range";
    range2.id = "range2";
    range2.style.zIndex = "2";
    range2.style.position = "absolute";
    range2.style.left = "55%";
    range2.style.bottom = "10px";
    range2.className = "toggle";
    range2.style.cursor = "pointer";
    range2.style.width = "10%";
    range2.style.display = "none";

    enableView.style.position = "absolute";
    enableView.style.right = "10px";
    enableView.style.top = "10px";
    enableView.onclick = toggle;
    enableView.style.zIndex = "1";
    enableView.src = "../img/pixelmator/gear_black.png";
    enableView.style.width = "25px";
    enableView.style.cursor = "pointer";
    enableView.id = "toggle";

    controller1.id = "controller1";
    controller1.className = "toggle";
    controller1.style.display = "none";
    controller1.style.position = "absolute";
    controller1.style.left = "33%";
    controller1.style.bottom = "0";
    controller1.style.minWidth = "33%";
    controller1.style.minHeight = "10%";
    controller1.style.zIndex = "1";
    controller1.style.backgroundColor = "black";
    controller1.style.opacity = "0.8";
    controller1.style.borderTopLeftRadius = "10px";
    controller1.style.borderTopRightRadius = "10px";

    document.getElementById("phylocanvas").appendChild(radio);
    document.getElementById("phylocanvas").appendChild(enableView);
    document.getElementById("phylocanvas").appendChild(firstDiv);

    document.getElementById("firstDiv").appendChild(button6);
    document.getElementById("firstDiv").appendChild(secondDiv);

    document.getElementById("dropdown-content").appendChild(a1);
    document.getElementById("dropdown-content").appendChild(a2);
    document.getElementById("dropdown-content").appendChild(a3);
    document.getElementById("dropdown-content").appendChild(a4);
    document.getElementById("dropdown-content").appendChild(a5);

    document.getElementById("phylocanvas").appendChild(range1);
    document.getElementById("phylocanvas").appendChild(range2);

    document.getElementById("phylocanvas").appendChild(controller1);

    // -------------------------------------- Button Dynamics

    function toggle() {

        let x = document.getElementsByClassName("toggle");

        console.log(x);

        for (let i = 0; i < x.length; i++) {
            if (x[i].style.display === "none") {
                x[i].style.display = "block";
                document.getElementById("shape").style.display = "block";
                document.getElementById("toggle").style.transform = "rotate(-15deg)";
            } else {
                x[i].style.display = "none";
                document.getElementById("shape").style.display = "none";
                document.getElementById("toggle").style.transform = "rotate(15deg)";
            }
        }
    }

    function appear() {

        secondDiv.style.display = "block";

    }

    function disappear() {

        secondDiv.style.display = "none";

    }

    let shapes = ["Radial", "Rectangular", "Circular", "Diagonal", "Hierarchical"];

    for (let i = 0; i < shapes.length; i++) {

        document.getElementById(shapes[i]).addEventListener("click", function () {

            plot(shapes[i]);

        });

        document.getElementById(shapes[i]).addEventListener("mouseout", function () {

            document.getElementById(shapes[i]).style.backgroundColor = "white";
            document.getElementById(shapes[i]).style.color = "black";

        });

        document.getElementById(shapes[i]).addEventListener("mouseover", function () {

            document.getElementById(shapes[i]).style.backgroundColor = "black";
            document.getElementById(shapes[i]).style.color = "white";

        });
    }

    document.getElementById("range1").addEventListener("input", function () {

        tree.setNodeSize(document.getElementById("range1").value);

        tree.draw();

    });

    document.getElementById("range2").addEventListener("input", function () {

        tree.setTextSize(document.getElementById("range2").value);

        tree.draw();

    });

    // ------------------------------------------ Geographical Map ------------------------------------------

    function geoMap(input) {

        let markers_init = {};

        for (let i = 0; i < Object.keys(input).length; i++) {

            for (let j = 0; j < Object.keys(Object.values(input)[i]).length; j++) {

                if (Object.keys(Object.values(input)[i])[j].search("lat") !== -1) {

                    markers_init[Object.keys(input)[i]] = markers_init[Object.keys(input)[i]] || {};
                    markers_init[Object.keys(input)[i]]["lat"] = input[(Object.keys(input)[i])][Object.keys(Object.values(input)[i])[j]];

                } else if (Object.keys(Object.values(input)[i])[j].search("long") !== -1) {

                    markers_init[Object.keys(input)[i]]["long"] = input[(Object.keys(input)[i])][Object.keys(Object.values(input)[i])[j]];

                }
            }
        }

        // mapid is the id of the div where the map will appear
        let map = L
            .map('mapid')
            .setView([38, 9], 5);   // center position + zoom

        /*

        MAPS CHOICE (URLs):
        Dark (No Labels) - https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png
        Dark (Labels) - https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png

        Satellite (No Labels) - https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}

        */

        // Add a tile to the map = a background. Comes from OpenStreetmap
        L.tileLayer(
            'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
            //   attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
                maxZoom: 10,

            }).addTo(map);

        // Add a svg layer to the map
        L.svg().addTo(map);

        // Create data for circles:
      /*  let markers = [
            {long: 9.083, lat: 42.149}, // corsica
            {long: 7.26, lat: 43.71}, // nice
            {long: 2.349, lat: 48.864}, // Paris
            {long: -1.397, lat: 43.664}, // Hossegor
            {long: 3.075, lat: 50.640}, // Lille
            {long: -3.83, lat: 48}, // Morlaix
        ];
       */

        map.zoomControl.remove();

        let markers = Object.values(input);

        // Select the svg area and add circles:
        d3.select("#mapid")
            .select("svg")
            .selectAll("myCircles")
            .data(markers)
            .enter()
            .append("circle")
            .attr("cx", function (d) {
                return map.latLngToLayerPoint([d.latitude, d.longitude]).x
            })
            .attr("cy", function (d) {
                return map.latLngToLayerPoint([d.latitude, d.longitude]).y
            })
            .attr("r", function (d) {
                return label2number("Region", markers, d.Region)*20
            })
            .style("fill", function (d) {
                return "#" + intToRGB(hashCode(d.vaccine_status))
            })
            //   .attr("stroke", "red")
            .attr("stroke-width", 3)
            .attr("fill-opacity", .3);

        // Function that update circle position if something change
        function update() {
            d3.selectAll("circle")
                .attr("cx", function (d) {
                    return map.latLngToLayerPoint([d.latitude, d.longitude]).x
                })
                .attr("cy", function (d) {
                    return map.latLngToLayerPoint([d.latitude, d.longitude]).y
                })
        }

        // If the user change the map (zoom or drag), I update circle position:
        map.on("moveend", update);

        document.getElementById("range3").addEventListener("input", function () {

            d3.selectAll("circle")
                .attr("r", function (d) {
                    return label2number("Region", markers, d.Region)*(document.getElementById("range3").value)
                });

            map.dragging.disable();

        });

        document.getElementById("range3").addEventListener("mouseup", function () {

            map.dragging.enable();

        });

        // --------------------------------------------------------------------------

        document.getElementById("toggle2").addEventListener("mousedown", function () {

            let x = document.getElementsByClassName("toggle2");

            for (let i = 0; i < x.length; i++) {
                if (x[i].style.display === "none") {
                    x[i].style.display = "block";
                    map.zoomControl.addTo(map);
                    // document.getElementById("shape").style.display = "block";
                    document.getElementById("toggle2").style.transform = "rotate(-15deg)";
                } else {
                    x[i].style.display = "none";
                    map.zoomControl.remove();
                    document.getElementById("toggle2").style.transform = "rotate(15deg)";
                }
            }

            map.doubleClickZoom.disable();

        });

        document.getElementById("toggle2").addEventListener("mouseleave", function () {

            map.doubleClickZoom.enable();

        });

    }

    // -------------------------------------- Buttons

    let enableView2 = document.createElement("IMG");

    let range3 = document.createElement("INPUT");

    let controller2 = document.createElement("DIV");

    let button62 = document.createElement("IMG");

    let firstDiv2 = document.createElement("DIV");
    let secondDiv2 = document.createElement("DIV");

    firstDiv2.id = "firstDiv2";
    firstDiv2.classList.add("toggle");
    firstDiv2.classList.add("dropdown");
    firstDiv2.style.position = "absolute";
    firstDiv2.style.left = "53%";
    firstDiv2.style.bottom = "10px";
    firstDiv2.style.zIndex = "2";
    firstDiv2.style.display = "none";

    secondDiv2.id = "dropdown-content";
    secondDiv2.class = "dropdown-content";
    secondDiv2.style.lineHeight = "18px";
    secondDiv2.style.display = "none";
    secondDiv2.style.position = "absolute";
    secondDiv2.style.bottom = "30px";
    secondDiv2.style.left = "-50%";
    secondDiv2.style.zIndex = "20";
    secondDiv2.style.boxShadow = "0 8px 16px 0 rgba(0,0,0,0.2)";
    secondDiv2.onmouseover = appear;
    secondDiv2.onmouseout = disappear;

    button62.id = "shape2";
    button62.style.textAlign = "center";
    button62.onmouseover = appear;
    button62.onmouseout = disappear;
    button62.onclick = backFunc2;
    button62.src = "../img/circular.png";
    button62.style.width = "30px";
    button62.style.left = "50%";

    a1.id = "Radial";
    a1.style.cursor = "pointer";
    a1.style.display = "block";
    a1.style.padding = "12px 16px";
    a1.style.zIndex = "2";
    a1.src = "../img/radial.png";
    a1.style.width = "25px";

    a2.id = "Rectangular";
    a2.style.cursor = "pointer";
    a2.style.display = "block";
    a2.style.padding = "12px 16px";
    a2.style.zIndex = "2";
    a2.src = "../img/rectangular.png";
    a2.style.width = "25px";

    a3.id = "Circular";
    a3.style.cursor = "pointer";
    a3.style.display = "block";
    a3.style.padding = "12px 16px";
    a3.style.zIndex = "2";
    a3.src = "../img/circular.png";
    a3.style.width = "25px";

    a4.id = "Diagonal";
    a4.style.cursor = "pointer";
    a4.style.display = "block";
    a4.style.padding = "12px 16px";
    a4.style.zIndex = "2";
    a4.src = "../img/diagonal.png";
    a4.style.width = "25px";

    a5.id = "Hierarchical";
    a5.style.cursor = "pointer";
    a5.style.display = "block";
    a5.style.padding = "12px 16px";
    a5.style.zIndex = "2";
    a5.src = "../img/hierarchical.png";
    a5.style.width = "25px";

    enableView2.style.position = "absolute";
    enableView2.style.right = "10px";
    enableView2.style.top = "10px";
    enableView2.style.zIndex = "1000";
    enableView2.src = "../img/pixelmator/gear_white.png";
    enableView2.style.width = "25px";
    enableView2.style.cursor = "pointer";
    enableView2.id = "toggle2";

    controller2.id = "controller2";
    controller2.className = "toggle2";
    controller2.style.display = "none";
    controller2.style.position = "absolute";
    controller2.style.left = "33%";
    controller2.style.bottom = "0";
    controller2.style.minWidth = "33%";
    controller2.style.minHeight = "10%";
    controller2.style.zIndex = "800";
    controller2.style.backgroundColor = "black";
    //controller2.style.opacity = "0.5";
    controller2.style.borderTopLeftRadius = "10px";
    controller2.style.borderTopRightRadius = "10px";

    range3.type = "range";
    range3.id = "range3";
    range3.style.zIndex = "1000";
    range3.style.position = "absolute";
    range3.style.left = "33%";
    range3.style.bottom = "10px";
    range3.className = "toggle2";
    range3.style.cursor = "pointer";
    range3.style.width = "33%";
    range3.style.display = "none";

    document.getElementById("mapid").appendChild(enableView2);

    document.getElementById("mapid").appendChild(controller2);

    document.getElementById("controller2").appendChild(range3);

    document.getElementById("mapid").appendChild(firstDiv2);

    document.getElementById("firstDiv2").appendChild(button62);
    document.getElementById("firstDiv2").appendChild(secondDiv2);

    document.getElementById("dropdown-content").appendChild(a1);
    document.getElementById("dropdown-content").appendChild(a2);
    document.getElementById("dropdown-content").appendChild(a3);
    document.getElementById("dropdown-content").appendChild(a4);
    document.getElementById("dropdown-content").appendChild(a5);

    // -------------------------------------- Button Dynamics

    function backFunc2() {

        console.log("hello");
    }

    // -------------------------------------- Tooltip

    // create a tooltip
    let Tooltip = d3.select('#mapid')
        .append("div")
        .style("position", "absolute")
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "2px")
        .style("border-radius", "5px")
        .style("padding", "5px");

    // Three function that change the tooltip when user hover / move / leave a cell
    let mouseover = function(d) {

        Tooltip
            .style("opacity", 1);
    };

    let mousemove = function(d) {

        let number = svg_input.split("g")[1];

        if(number%2 !== 0) {
            Tooltip
                .html(d.value + " ± " + d.error)
                .style("left", (d3.mouse(this)[0] + margin.left + 15) + "px")
                .style("top", (d3.mouse(this)[1] + margin.top + 70) + "px")
        } else {
            Tooltip
                .html(d.value + " ± " + d.error)
                .style("left", (d3.mouse(this)[0] + margin.left + 775) + "px")
                .style("top", (d3.mouse(this)[1] + margin.top + 70) + "px")
        }
    };

    let mouseleave = function(d) {
        Tooltip
            .style("opacity", 0);
    };


</script>

</body>

</html>